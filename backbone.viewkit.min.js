(function(){function n(){return{items:[],push:function(e){this.items.push(e)},pop:function(){return this.items.pop()},top:function(){return this.items[this.items.length-1]},empty:function(){return this.items.length===0}}}var e=Backbone.ViewKit={};e.ViewPort=Backbone.View.extend({getView:function(){return null},render:function(e){var t=this.getView(),n=this._current;return t===n?this:(t?(this.$el.append(t.$el),n&&e?e.run(n.$el,t.$el,function(){n.remove()}):n&&n.remove(),t.delegateEvents(),this._current=t):(n&&n.remove(),this._current=null,this.$el.empty()),this)},delegateEvents:function(){Backbone.View.prototype.delegateEvents.apply(this,arguments);var e=this.getView();e&&e.delegateEvents()}}),e.ViewStack=e.ViewPort.extend({constructor:function(t){t||(t={}),this._stack=n(),this.transitions=t.transitions||{},e.ViewPort.prototype.constructor.apply(this,arguments)},getView:function(){return this._stack.top()},pushView:function(e,t){e.viewStack=this,this._stack.push(e),this.render(t||this.transitions.push),this.trigger("pushed",e)},popView:function(e){var t=this._stack.pop();return t&&this._cleanup(t),this.render(e||this.transitions.pop),this.trigger("popped",t),t},replaceView:function(e,t){if(this._stack.empty())throw new Error("View stack is empty");var n=this._stack.pop();return n&&this._cleanup(n),e.viewStack=this,this._stack.push(e),this.render(t||this.transitions.replace),this.trigger("popped",n),this.trigger("pushed",e),this.trigger("replaced",e,n),n},_cleanup:function(e){delete e.viewStack}}),e.ViewSelector=e.ViewPort.extend({constructor:function(t){this._views=[],this._index=null,t||(t={}),this.transition=t.transition,t.views&&this.setViews(t.views),e.ViewPort.prototype.constructor.apply(this,arguments)},getView:function(){return this._views[this._index]},getViews:function(){return this._views},setViews:function(e){var t=this;_.each(this._views,function(e){t._cleanup(e)}),_.each(e,function(e){e.viewSelector=t}),this._views=e,this._index=null},selectView:function(e,t){if(e>=this._views.length||e<0)throw new Error("Index out of bounds");this._index=e,this.render(t||this.transition),this.trigger("selected",this.getView(),e)},_cleanup:function(e){delete e.viewSelector}}),e.Transition=function(e){e||(e={}),this.initialize(e),this.transition&&_.extend(this.transition,_.pick(e,"duration","easing","delay"))};var t=e.Transition.Config={transform:"-webkit-transform",transition:"-webkit-transition",transitionEnd:"webkitTransitionEnd"};_.extend(e.Transition.prototype,Backbone.Events,{initialize:function(e){},before:function(e,t){},after:function(e,t){},cleanup:function(e,t){},run:function(e,n,r){function a(){if(++o!==2)return;i.css(t.transition,""),i.off(t.transitionEnd,a),u.cleanup(e,n),u.trigger("end"),r()}this.trigger("start"),this.before(e,n);if(!this.transition)return this.after(e,n),this.cleanup(e,n),this.trigger("end"),r();var i=e.add(n),s=[this.transition.property,this.transition.duration+"s",this.transition.easing,this.transition.delay+"s"].join(" ");i.css(t.transition,s),i.on(t.transitionEnd,a),this.after(e,n);var o=0,u=this}}),e.Transition.extend=Backbone.View.extend,e.Transitions={},e.Transitions.Slide=e.Transition.extend({transition:{property:t.transform,duration:.4,easing:"ease-out",delay:0},initialize:function(e){this.reverse=!!e.reverse},before:function(e,t){var n=e.parent().width();e.css("left",0),t.css("left",this.reverse?-n:n)},after:function(e,n){var r=e.parent().width(),i=this.reverse?r:-r,s=e.add(n);s.css(t.transform,"translateX("+i+"px)")},cleanup:function(e,n){var r=e.add(n);r.css(t.transform,""),r.css("left","")}}),e.Transitions.Fade=e.Transition.extend({transition:{property:"opacity",duration:.4,easing:"ease-out",delay:0},before:function(e,t){t.css("opacity",0),e.css("opacity",1)},after:function(e,t){t.show().css("opacity",1),e.css("opacity",0)},cleanup:function(e,t){var n=e.add(t);n.css("opacity",""),n.css("display","")}})})();